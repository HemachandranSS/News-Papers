<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Sales Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            text-align: center;
            margin-bottom: 10px;
        }
        h1 {
            font-size: 28px;
        }
        h2 {
            font-size: 20px;
            color: #555;
            margin-bottom: 30px;
        }
        h3 {
            font-size: 18px;
            margin-top: 30px;
        }
        .tab-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        .tab {
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f5f5f5;
            cursor: pointer;
        }
        .tab.active {
            background-color: #4a90e2;
            color: white;
            font-weight: bold;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin-bottom: 40px;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            pointer-events: none;
            opacity: 0;
            z-index: 10;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .bar-feb24 {
            fill: #8884d8;
        }
        .bar-feb25 {
            fill: #82ca9d;
        }
        .bar-positive {
            fill: #4CAF50;
        }
        .bar-negative {
            fill: #F44336;
        }
        .source {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 20px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
        }
    </style>
</head>
<body>
    <h1>Revving up</h1>
    <h2>Auto domestic wholesale for February 2025</h2>
    
    <div class="tab-container" id="categoryTabs"></div>
    
    <h3>Sales Volume Comparison</h3>
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #8884d8;"></div>
            <span>February 2024</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #82ca9d;"></div>
            <span>February 2025</span>
        </div>
    </div>
    <div class="chart-container" id="volumeChart"></div>
    
    <h3>Percentage Change (Feb 2024 to Feb 2025)</h3>
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #4CAF50;"></div>
            <span>Positive Change</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #F44336;"></div>
            <span>Negative Change</span>
        </div>
    </div>
    <div class="chart-container" id="percentChart"></div>
    
    <div class="source">Source: Companies</div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Data
        const data = {
            "title": "Revving up",
            "subtitle": "Auto domestic wholesale for February 2025",
            "unit": "in units",
            "categories": [
                {
                    "name": "Passenger vehicles",
                    "companies": [
                        {
                            "name": "Maruti Suzuki India",
                            "Feb-24": 160271,
                            "Feb-25": 160791,
                            "percentChange": 0.32
                        },
                        {
                            "name": "Hyundai Motor India",
                            "Feb-24": 50201,
                            "Feb-25": 47727,
                            "percentChange": -5
                        },
                        {
                            "name": "Tata Motors",
                            "Feb-24": 51267,
                            "Feb-25": 46435,
                            "percentChange": -9
                        },
                        {
                            "name": "M&M",
                            "Feb-24": 42401,
                            "Feb-25": 50420,
                            "percentChange": 19
                        },
                        {
                            "name": "Kia India",
                            "Feb-24": 20200,
                            "Feb-25": 25026,
                            "percentChange": 24
                        },
                        {
                            "name": "Toyota Kirloskar Motor",
                            "Feb-24": 23293,
                            "Feb-25": 26414,
                            "percentChange": 13
                        },
                        {
                            "name": "Honda Cars India",
                            "Feb-24": 7142,
                            "Feb-25": 5616,
                            "percentChange": -21
                        },
                        {
                            "name": "JSW MG Motor India",
                            "Feb-24": 4592,
                            "Feb-25": 4002,
                            "percentChange": -13
                        },
                        {
                            "name": "Renault India",
                            "Feb-24": 4080,
                            "Feb-25": 3916,
                            "percentChange": -4
                        },
                        {
                            "name": "Volkswagen India",
                            "Feb-24": 3019,
                            "Feb-25": 3110,
                            "percentChange": -7
                        },
                        {
                            "name": "Skoda India",
                            "Feb-24": 2254,
                            "Feb-25": 5583,
                            "percentChange": 35
                        },
                        {
                            "name": "Nissan India",
                            "Feb-24": 2755,
                            "Feb-25": 2328,
                            "percentChange": -3
                        }
                    ]
                },
                {
                    "name": "Two-wheelers",
                    "companies": [
                        {
                            "name": "TVS Motor",
                            "Feb-24": 267502,
                            "Feb-25": 276072,
                            "percentChange": 3
                        },
                        {
                            "name": "Royal Enfield",
                            "Feb-24": 67922,
                            "Feb-25": 80799,
                            "percentChange": 19
                        },
                        {
                            "name": "Suzuki Motorcycle",
                            "Feb-24": 83304,
                            "Feb-25": 73455,
                            "percentChange": -12
                        }
                    ]
                },
                {
                    "name": "Commercial vehicles",
                    "companies": [
                        {
                            "name": "Volvo Eicher",
                            "Feb-24": 6930,
                            "Feb-25": 7357,
                            "percentChange": 6
                        },
                        {
                            "name": "Tata Motors",
                            "Feb-24": 33567,
                            "Feb-25": 30797,
                            "percentChange": -8
                        },
                        {
                            "name": "M&M",
                            "Feb-24": 22825,
                            "Feb-25": 23826,
                            "percentChange": 4
                        },
                        {
                            "name": "Maruti Suzuki",
                            "Feb-24": 3126,
                            "Feb-25": 2710,
                            "percentChange": -13
                        }
                    ]
                },
                {
                    "name": "Tractors",
                    "companies": [
                        {
                            "name": "Escorts Kubota",
                            "Feb-24": 7269,
                            "Feb-25": 7968,
                            "percentChange": 9.6
                        },
                        {
                            "name": "M&M",
                            "Feb-24": 20121,
                            "Feb-25": 23880,
                            "percentChange": 19
                        }
                    ]
                }
            ],
            "source": "Companies"
        };

        // Initialize active category
        let activeCategory = "Passenger vehicles";

        // Create category tabs
        const tabContainer = document.getElementById('categoryTabs');
        data.categories.forEach(category => {
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.textContent = category.name;
            if (category.name === activeCategory) {
                tab.classList.add('active');
            }
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                activeCategory = category.name;
                updateCharts();
            });
            tabContainer.appendChild(tab);
        });

        // Tooltip element
        const tooltip = d3.select('#tooltip');

        // Function to update charts based on active category
        function updateCharts() {
            updateVolumeChart();
            updatePercentChart();
        }

        // Volume Chart
        function updateVolumeChart() {
            const chartContainer = document.getElementById('volumeChart');
            chartContainer.innerHTML = '';

            const currentCategoryData = data.categories.find(c => c.name === activeCategory).companies;
            
            // Set up dimensions
            const margin = {top: 20, right: 30, bottom: 100, left: 60};
            const width = chartContainer.clientWidth - margin.left - margin.right;
            const height = chartContainer.clientHeight - margin.top - margin.bottom;

            // Create SVG
            const svg = d3.select('#volumeChart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Find max value for y scale
            const maxValue = d3.max(currentCategoryData, d => Math.max(d['Feb-24'], d['Feb-25'])) * 1.1;

            // Set up scales
            const x = d3.scaleBand()
                .domain(currentCategoryData.map(d => d.name))
                .range([0, width])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, maxValue])
                .range([height, 0]);

            // Create axes
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('transform', 'rotate(-45)')
                .style('text-anchor', 'end')
                .attr('dx', '-.8em')
                .attr('dy', '.15em');

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => d3.format(',')(d)));

            // Calculate bar width
            const barWidth = x.bandwidth() / 2 - 2;

            // Add bars for Feb-24
            svg.selectAll('.bar-feb24')
                .data(currentCategoryData)
                .enter()
                .append('rect')
                .attr('class', 'bar-feb24')
                .attr('x', d => x(d.name))
                .attr('width', barWidth)
                .attr('y', d => y(d['Feb-24']))
                .attr('height', d => height - y(d['Feb-24']))
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`<strong>${d.name}</strong><br>
                                Feb 2024: ${d['Feb-24'].toLocaleString()}<br>
                                Feb 2025: ${d['Feb-25'].toLocaleString()}<br>
                                Change: ${d.percentChange}%`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });

            // Add bars for Feb-25
            svg.selectAll('.bar-feb25')
                .data(currentCategoryData)
                .enter()
                .append('rect')
                .attr('class', 'bar-feb25')
                .attr('x', d => x(d.name) + barWidth + 2)
                .attr('width', barWidth)
                .attr('y', d => y(d['Feb-25']))
                .attr('height', d => height - y(d['Feb-25']))
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`<strong>${d.name}</strong><br>
                                Feb 2024: ${d['Feb-24'].toLocaleString()}<br>
                                Feb 2025: ${d['Feb-25'].toLocaleString()}<br>
                                Change: ${d.percentChange}%`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });
        }

        // Percent Chart
        function updatePercentChart() {
            const chartContainer = document.getElementById('percentChart');
            chartContainer.innerHTML = '';

            const currentCategoryData = data.categories.find(c => c.name === activeCategory).companies;
            
            // Set up dimensions
            const margin = {top: 20, right: 30, bottom: 100, left: 60};
            const width = chartContainer.clientWidth - margin.left - margin.right;
            const height = chartContainer.clientHeight - margin.top - margin.bottom;

            // Create SVG
            const svg = d3.select('#percentChart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Find max/min values for y scale
            const maxValue = d3.max(currentCategoryData, d => d.percentChange) * 1.1;
            const minValue = d3.min(currentCategoryData, d => d.percentChange) * 1.1;
            const yDomain = [Math.min(minValue, 0), Math.max(maxValue, 0)];

            // Set up scales
            const x = d3.scaleBand()
                .domain(currentCategoryData.map(d => d.name))
                .range([0, width])
                .padding(0.3);

            const y = d3.scaleLinear()
                .domain(yDomain)
                .range([height, 0]);

            // Create axes
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('transform', 'rotate(-45)')
                .style('text-anchor', 'end')
                .attr('dx', '-.8em')
                .attr('dy', '.15em');

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + '%'));

            // Add zero line
            svg.append('line')
                .attr('x1', 0)
                .attr('x2', width)
                .attr('y1', y(0))
                .attr('y2', y(0))
                .attr('stroke', '#000')
                .attr('stroke-width', 1);

            // Add percent change bars
            svg.selectAll('.bar')
                .data(currentCategoryData)
                .enter()
                .append('rect')
                .attr('class', d => d.percentChange >= 0 ? 'bar-positive' : 'bar-negative')
                .attr('x', d => x(d.name))
                .attr('width', x.bandwidth())
                .attr('y', d => d.percentChange >= 0 ? y(d.percentChange) : y(0))
                .attr('height', d => Math.abs(y(0) - y(d.percentChange)))
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`<strong>${d.name}</strong><br>
                                Change: ${d.percentChange}%`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });
        }

        // Initial chart rendering
        window.addEventListener('load', updateCharts);
        window.addEventListener('resize', updateCharts);
    </script>
</body>
</html>
