<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: Arial;
        margin: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .search-box {
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      input {
        width: 70%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
      }
      button {
        padding: 10px 20px;
        background: #2c3e50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #34495e;
      }
      .stock-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }
      .stock-table th {
        background: #2c3e50;
        color: white;
        padding: 15px;
        text-align: left;
      }
      .stock-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #ddd;
      }
      .stock-table tr:hover {
        background: #f8f9fa;
      }
      .positive {
        color: green;
        font-weight: bold;
      }
      .negative {
        color: red;
        font-weight: bold;
      }
      .time {
        color: #666;
        font-size: 0.9em;
      }
      #loading,
      #error {
        text-align: center;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="search-box">
        <input
          type="text"
          id="searchInput"
          placeholder="Search for stocks..."
        />
        <button onclick="searchStocks()">Search</button>
      </div>
      <div id="loading" style="display: none">Loading...</div>
      <div id="error" style="display: none"></div>
      <table class="stock-table" id="stockTable" style="display: none">
        <thead>
          <tr>
            <th>Company</th>
            <th>LTP</th>
            <th>Change</th>
            <th>Change %</th>
            <th>Volume</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody id="stockBody"></tbody>
      </table>
    </div>

    <script>
      const searchInput = document.getElementById("searchInput");
      const stockTable = document.getElementById("stockTable");
      const stockBody = document.getElementById("stockBody");
      const loading = document.getElementById("loading");
      const error = document.getElementById("error");

      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") searchStocks();
      });

      async function searchStocks() {
        const query = searchInput.value.trim();
        if (!query) return;

        loading.style.display = "block";
        error.style.display = "none";
        stockTable.style.display = "none";

        try {
          const response = await fetch(
            `https://blstocks.thehindubusinessline.com/companiesinfo/search?query=${query}`
          );
          const data = await response.json();
          displayStocks(data.companiesDetails || []);
        } catch (err) {
          error.style.display = "block";
          error.textContent = "Failed to fetch stock data";
        } finally {
          loading.style.display = "none";
        }
      }

      function displayStocks(stocks) {
        if (!stocks.length) {
          error.style.display = "block";
          error.textContent = "No stocks found";
          return;
        }

        stockBody.innerHTML = stocks
          .map(
            (stock) => `
        <tr>
            <td><a href="${stock.url}" target="_blank">${stock.title}</a></td>
            <td>â‚¹${stock.LTP?.toFixed(2) || "N/A"}</td>
            <td class="${
              stock.CHANGE ? (stock.CHANGE >= 0 ? "positive" : "negative") : ""
            }">
                ${
                  stock.CHANGE
                    ? (stock.CHANGE >= 0 ? "+" : "") + stock.CHANGE.toFixed(2)
                    : "N/A"
                }
            </td>
            <td class="${
              stock.change_PERC
                ? stock.change_PERC >= 0
                  ? "positive"
                  : "negative"
                : ""
            }">
                ${
                  stock.change_PERC
                    ? (stock.change_PERC >= 0 ? "+" : "") +
                      stock.change_PERC.toFixed(2) +
                      "%"
                    : "N/A"
                }
            </td>
            <td>${stock.VOLUME?.toLocaleString() || "N/A"}</td>
            <td class="time">${
              stock.Upd_Time
                ? new Date(stock.Upd_Time).toLocaleTimeString()
                : "N/A"
            }</td>
        </tr>
    `
          )
          .join("");

        stockTable.style.display = "table";
      }
    </script>
  </body>
</html>
